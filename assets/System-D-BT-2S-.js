import{u as H}from"./useHttp-B8f2O1Te.js";import{G as $,d as M,u as I,s as q,k as b,r as o,o as E,c as P,w as t,e as w,a as e,l as p,E as J,A as Q,f as W,i as r,F as X,h as Y,t as D}from"./index-BJISwmxh.js";function F(m){return m.map(s=>{const i={label:s.name,url:s.url};return s.children&&(i.children=F(s.children)),i})}function Z(m){return $("/userAuth",{pageAuthority:m})}function ee(m,s,i){return $("/setAuth",{account:m,btnList:s,pageList:i})}const te={class:"dialog-footer"},le=M({__name:"AuthModal",props:{visible:{type:Boolean},checkedKeys:{},btnAuth:{},account:{}},emits:["close","reload"],setup(m,{emit:s}){const i=m,k=s,S=I(),{menu:x}=q(S),U=b(F(x.value)),_=b(),g=b([]),B=()=>{_.value.setCheckedKeys(i.checkedKeys),g.value=i.btnAuth},C=()=>{k("close")},N=async()=>{const f=await ee(i.account,_.value.getCheckedKeys(!0),g.value);f.code==200&&(J({message:f.message,type:"success"}),k("close"),k("reload"))};return(f,u)=>{const z=o("el-tree"),V=o("el-card"),h=o("el-checkbox"),y=o("el-checkbox-group"),l=o("el-button"),v=o("el-dialog");return E(),P(v,{title:"权限设置",width:"600px","model-value":f.visible,onOpen:B,onClose:C},{footer:t(()=>[w("div",te,[e(l,{onClick:u[1]||(u[1]=n=>f.$emit("close"))},{default:t(()=>u[4]||(u[4]=[p("取消")])),_:1}),e(l,{type:"primary",onClick:N},{default:t(()=>u[5]||(u[5]=[p(" 确认 ")])),_:1})])]),default:t(()=>[e(V,null,{header:t(()=>u[2]||(u[2]=[w("div",{class:"card-header"},[w("span",null,"页面权限")],-1)])),default:t(()=>[e(z,{ref_key:"treeRef",ref:_,style:{"max-width":"600px"},"show-checkbox":"",data:U.value,"node-key":"url"},null,8,["data"])]),_:1}),e(V,{class:"mt"},{header:t(()=>u[3]||(u[3]=[w("div",{class:"card-header"},[w("span",null,"按钮权限")],-1)])),default:t(()=>[e(y,{modelValue:g.value,"onUpdate:modelValue":u[0]||(u[0]=n=>g.value=n),class:"mt"},{default:t(()=>[e(h,{label:"全部",value:"all"}),e(h,{label:"添加",value:"add"}),e(h,{label:"编辑",value:"edit"}),e(h,{label:"删除",value:"delete"})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model-value"])}}}),se=M({__name:"System",setup(m){const s=b({name:"",department:""}),{dataList:i,loading:k,resetPagination:S,loadData:x,totals:U,pageInfo:_,handleCurrentChange:g,handleSizeChange:B}=H("/permissionList",s),C=b(!1);function N(y){const l=[];function v(n){n.url&&!n.children&&l.push(n.url),n.children&&n.children.forEach(c=>v(c))}return y.forEach(n=>v(n)),l}const f=b([]),u=b([]),z=b(""),V=async(y,l)=>{z.value=l;const{data:{list:v,btn:n}}=await Z(y);u.value=N(v),f.value=n,C.value=!0},h=()=>{s.value={name:"",department:""},S()};return(y,l)=>{const v=o("el-input"),n=o("el-col"),c=o("el-option"),L=o("el-select"),A=o("el-button"),O=o("el-row"),K=o("el-card"),d=o("el-table-column"),R=o("el-tag"),T=o("el-table"),j=o("el-pagination"),G=Q("loading");return E(),W(X,null,[e(K,null,{default:t(()=>[e(O,{gutter:20},{default:t(()=>[e(n,{span:6},{default:t(()=>[e(v,{modelValue:s.value.name,"onUpdate:modelValue":l[0]||(l[0]=a=>s.value.name=a),modelModifiers:{trim:!0},placeholder:"请输入姓名"},null,8,["modelValue"])]),_:1}),e(n,{span:6},{default:t(()=>[e(L,{placeholder:"请选择部门",modelValue:s.value.department,"onUpdate:modelValue":l[1]||(l[1]=a=>s.value.department=a)},{default:t(()=>[e(c,{label:"全部",value:""}),e(c,{label:"总裁办",value:"总裁办"}),e(c,{label:"技术部",value:"技术部"}),e(c,{label:"市场部",value:"市场部"}),e(c,{label:"维修部",value:"维修部"}),e(c,{label:"运营部",value:"运营部"}),e(c,{label:"客服部",value:"客服部"})]),_:1},8,["modelValue"])]),_:1}),e(n,{span:6},{default:t(()=>[e(A,{type:"primary",onClick:r(x)},{default:t(()=>l[5]||(l[5]=[p("查询")])),_:1},8,["onClick"]),e(A,{onClick:h},{default:t(()=>l[6]||(l[6]=[p("重置")])),_:1})]),_:1})]),_:1})]),_:1}),e(K,{class:"mt"},{default:t(()=>[Y((E(),P(T,{data:r(i)},{default:t(()=>[e(d,{type:"index",label:"序号",width:"80"}),e(d,{prop:"account",label:"账号"}),e(d,{prop:"name",label:"姓名"}),e(d,{prop:"phone",label:"电话"}),e(d,{prop:"idNo",label:"身份证号"}),e(d,{prop:"position",label:"职位"},{default:t(a=>[e(R,{type:"primary"},{default:t(()=>[p(D(a.row.position),1)]),_:2},1024)]),_:1}),e(d,{prop:"department",label:"部门"}),e(d,{prop:"pageAuthority",label:"页面权限"},{default:t(a=>[e(R,{type:"success"},{default:t(()=>[p(D(a.row.pageAuthority),1)]),_:2},1024)]),_:1}),e(d,{prop:"btnAuthority",label:"按钮权限"},{default:t(a=>[e(R,{type:"info"},{default:t(()=>[p(D(a.row.btnAuthority),1)]),_:2},1024)]),_:1}),e(d,{label:"操作",width:"280"},{default:t(a=>[e(A,{type:"primary",size:"small",onClick:ae=>V(a.row.pageAuthority,a.row.account)},{default:t(()=>l[7]||(l[7]=[p(" 权限设置 ")])),_:2},1032,["onClick"]),e(A,{type:"danger",size:"small"},{default:t(()=>l[8]||(l[8]=[p(" 删除 ")])),_:1}),e(A,{type:"danger",size:"small"},{default:t(()=>l[9]||(l[9]=[p(" 禁用 ")])),_:1})]),_:1})]),_:1},8,["data"])),[[G,r(k)]]),e(j,{class:"fr mt mb","current-page":r(_).page,"onUpdate:currentPage":l[2]||(l[2]=a=>r(_).page=a),"page-size":r(_).pageSize,"onUpdate:pageSize":l[3]||(l[3]=a=>r(_).pageSize=a),"page-sizes":[10,20,30,40],layout:"sizes, prev, pager, next, jumper,total",total:r(U),onSizeChange:r(B),onCurrentChange:r(g),background:""},null,8,["current-page","page-size","total","onSizeChange","onCurrentChange"])]),_:1}),e(le,{visible:C.value,"checked-keys":u.value,onClose:l[4]||(l[4]=a=>C.value=!1),btnAuth:f.value,account:z.value,onReload:r(x)},null,8,["visible","checked-keys","btnAuth","account","onReload"])],64)}}});export{se as default};
